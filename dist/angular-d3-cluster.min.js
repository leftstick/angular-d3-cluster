!function(t,e){"use strict";var n=function(n){var a={padding:1.5,clusterPadding:40,subjectRange:[30,45],arounderRange:[10,25],maxRadius:45,subjectFontSize:12,arounderFontSize:8,positiveColor:"#FF0000",negativeColor:"#00E700"},o={white:"#fff"},i=function(t,e){return t&&"undefined"!=typeof t[e]?t[e]:a[e]},r=function(a){return{restrict:"A",scope:{option:"=",data:"="},link:function(r,u){function l(t){P.each(d(10*t.alpha*t.alpha)).each(c(.5)).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"})}function d(t){return function(e){var n=A[e.cluster];if(n!==e){var a=e.x-n.x,o=e.y-n.y,i=Math.sqrt(a*a+o*o),r=e.radius+n.radius;i!=r&&(i=(i-r)/i*t,e.x-=a*=i,e.y-=o*=i,n.x+=a,n.y+=o)}}}function c(t){var e=n.geom.quadtree(F);return function(n){var a=n.radius+h+Math.max(f,v),o=n.x-a,i=n.x+a,r=n.y-a,u=n.y+a;e.visit(function(e,a,l,d,c){if(e.point&&e.point!==n){var s=n.x-e.point.x,p=n.y-e.point.y,h=Math.sqrt(s*s+p*p),g=n.radius+e.point.radius+(n.cluster===e.point.cluster?f:v);g>h&&(h=(h-g)/h*t,n.x-=s*=h,n.y-=p*=h,e.point.x+=s,e.point.y+=p)}return a>i||o>d||l>u||r>c})}}var s,p,f,v,h,g,b,y,m,x,k,C,M,j,w,z,S,A,F,P,R=t.element(e),$=0,q=0,D=function(){for(A=[],F=[],s=u.prop("clientWidth"),p=u.prop("clientHeight"),f=i(r.option,"padding"),v=i(r.option,"clusterPadding"),h=i(r.option,"maxRadius"),g=i(r.option,"subjectRange"),b=i(r.option,"arounderRange"),y=i(r.option,"subjectFontSize"),m=i(r.option,"arounderFontSize"),x=i(r.option,"positiveColor"),k=i(r.option,"negativeColor"),$=0;$<r.data.length;$++)for((!C||C>Math.abs(r.data[$].value))&&(C=Math.abs(r.data[$].value)),(!M||M<Math.abs(r.data[$].value))&&(M=Math.abs(r.data[$].value)),q=0;q<r.data[$].children.length;q++)(!j||j>Math.abs(r.data[$].children[q].value))&&(j=Math.abs(r.data[$].children[q].value)),(!w||w<Math.abs(r.data[$].children[q].value))&&(w=Math.abs(r.data[$].children[q].value));for(z=n.scale.linear().domain([C,M]).range(g),S=n.scale.linear().domain([j,w]).range(b),$=0;$<r.data.length;$++){var t={cluster:$,radius:z(Math.abs(r.data[$].value)),name:r.data[$].name,value:r.data[$].value,subjectId:r.data[$].subjectId};for(A.push(t),F.push(t),q=0;q<r.data[$].children.length;q++){var e={cluster:$,radius:S(Math.abs(r.data[$].children[q].value)),name:r.data[$].children[q].name,value:r.data[$].children[q].value,arounderId:r.data[$].children[q].arounderId};F.push(e)}}var a=n.layout.force().nodes(F).size([s,p]).gravity(.02).charge(-5).on("tick",l).start();u.find("svg").remove();var d=n.select(u[0]).append("svg").attr("width",s).attr("height",p);P=d.selectAll("g").data(F).enter().append("g").call(a.drag),P.append("circle").attr("r",function(t){return t.radius}).style("fill",function(t){return A[t.cluster]===t?o.white:t.value>=0?x:k}).style("stroke",function(t){return t.value>=0?x:k}).on("click",function(t){n.event.preventDefault&&n.event.preventDefault(),n.event.stopPropagation&&n.event.stopPropagation(),A[t.cluster]===t&&r.option&&r.option.onSubjectClick&&r.option.onSubjectClick(t),A[t.cluster]!==t&&r.option&&r.option.onArounderClick&&r.option.onArounderClick(t)}),P.append("text").text(function(t){return t.name}).attr({"alignment-baseline":"middle","text-anchor":"middle"}).style("font-size",function(t){return A[t.cluster]===t?y:m}).style("fill",function(t){return A[t.cluster]===t?t.value>=0?x:k:o.white}).style("display",function(t){return this.getComputedTextLength()>2*t.radius?"none":"block"}).on("click",function(t){n.event.preventDefault&&n.event.preventDefault(),n.event.stopPropagation&&n.event.stopPropagation(),A[t.cluster]===t&&r.option&&r.option.onSubjectClick&&r.option.onSubjectClick(t),A[t.cluster]!==t&&r.option&&r.option.onArounderClick&&r.option.onArounderClick(t)})};D(),r.$watch("option",function(t,e){t&&e&&D()},!0),r.$watch("data",function(){D()},!0);var I=function(){a(function(){D()},1e3)};R.on("resize",I),r.$on("$destroy",function(){R.off("resize",I)})}}},u=t.module("angular-d3-cluster",[]);u.directive("ngCluster",["$timeout",r])};"object"==typeof exports?module.exports=n(require("d3")):"function"==typeof define&&define.amd?define(["d3"],n):n(e.d3)}(angular,window);
//# sourceMappingURL=angular-d3-cluster.min.js.map