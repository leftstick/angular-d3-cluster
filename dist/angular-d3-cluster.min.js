!function(t,e){"use strict";var n=function(n){var a={padding:1.5,clusterPadding:40,subjectRange:[30,45],arounderRange:[10,25],maxRadius:45,subjectFontSize:12,arounderFontSize:8},i={positive:"#FF0000",negative:"#00E700",white:"#fff"},o=function(t,e){return t&&"undefined"!=typeof t[e]?t[e]:a[e]},r=function(a){return{restrict:"A",scope:{option:"=",data:"="},link:function(r,u){function d(t){A.each(l(10*t.alpha*t.alpha)).each(c(.5)).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"})}function l(t){return function(e){var n=z[e.cluster];if(n!==e){var a=e.x-n.x,i=e.y-n.y,o=Math.sqrt(a*a+i*i),r=e.radius+n.radius;o!=r&&(o=(o-r)/o*t,e.x-=a*=o,e.y-=i*=o,n.x+=a,n.y+=i)}}}function c(t){var e=n.geom.quadtree(S);return function(n){var a=n.radius+h+Math.max(f,v),i=n.x-a,o=n.x+a,r=n.y-a,u=n.y+a;e.visit(function(e,a,d,l,c){if(e.point&&e.point!==n){var s=n.x-e.point.x,p=n.y-e.point.y,h=Math.sqrt(s*s+p*p),g=n.radius+e.point.radius+(n.cluster===e.point.cluster?f:v);g>h&&(h=(h-g)/h*t,n.x-=s*=h,n.y-=p*=h,e.point.x+=s,e.point.y+=p)}return a>o||i>l||d>u||r>c})}}var s,p,f,v,h,g,b,y,m,x,k,M,j,C,w,z,S,A,F=t.element(e),P=0,R=0,$=function(){for(z=[],S=[],s=u.prop("clientWidth"),p=u.prop("clientHeight"),f=o(r.option,"padding"),v=o(r.option,"clusterPadding"),h=o(r.option,"maxRadius"),g=o(r.option,"subjectRange"),b=o(r.option,"arounderRange"),y=o(r.option,"subjectFontSize"),m=o(r.option,"arounderFontSize"),P=0;P<r.data.length;P++)for((!x||x>Math.abs(r.data[P].value))&&(x=Math.abs(r.data[P].value)),(!k||k<Math.abs(r.data[P].value))&&(k=Math.abs(r.data[P].value)),R=0;R<r.data[P].children.length;R++)(!M||M>Math.abs(r.data[P].children[R].value))&&(M=Math.abs(r.data[P].children[R].value)),(!j||j<Math.abs(r.data[P].children[R].value))&&(j=Math.abs(r.data[P].children[R].value));for(C=n.scale.linear().domain([x,k]).range(g),w=n.scale.linear().domain([M,j]).range(b),P=0;P<r.data.length;P++){var t={cluster:P,radius:C(Math.abs(r.data[P].value)),name:r.data[P].name,value:r.data[P].value,subjectId:r.data[P].subjectId};for(z.push(t),S.push(t),R=0;R<r.data[P].children.length;R++){var e={cluster:P,radius:w(Math.abs(r.data[P].children[R].value)),name:r.data[P].children[R].name,value:r.data[P].children[R].value,arounderId:r.data[P].children[R].arounderId};S.push(e)}}var a=n.layout.force().nodes(S).size([s,p]).gravity(.02).charge(-5).on("tick",d).start();u.find("svg").remove();var l=n.select(u[0]).append("svg").attr("width",s).attr("height",p);A=l.selectAll("g").data(S).enter().append("g").call(a.drag),A.append("circle").attr("r",function(t){return t.radius}).style("fill",function(t){return z[t.cluster]===t?i.white:t.value>=0?i.positive:i.negative}).style("stroke",function(t){return t.value>=0?i.positive:i.negative}).on("click",function(t){n.event.preventDefault&&n.event.preventDefault(),n.event.stopPropagation&&n.event.stopPropagation(),z[t.cluster]===t&&r.option&&r.option.onSubjectClick&&r.option.onSubjectClick(t),z[t.cluster]!==t&&r.option&&r.option.onArounderClick&&r.option.onArounderClick(t)}),A.append("text").text(function(t){return t.name}).attr({"alignment-baseline":"middle","text-anchor":"middle"}).style("font-size",function(t){return z[t.cluster]===t?y:m}).style("fill",function(t){return z[t.cluster]===t?t.value>=0?i.positive:i.negative:i.white}).style("display",function(t){return this.getComputedTextLength()>2*t.radius?"none":"block"}).on("click",function(t){n.event.preventDefault&&n.event.preventDefault(),n.event.stopPropagation&&n.event.stopPropagation(),z[t.cluster]===t&&r.option&&r.option.onSubjectClick&&r.option.onSubjectClick(t),z[t.cluster]!==t&&r.option&&r.option.onArounderClick&&r.option.onArounderClick(t)})};$(),r.$watch("option",function(t,e){t&&e&&$()},!0),r.$watch("data",function(){$()},!0);var q=function(){a(function(){$()},1e3)};F.on("resize",q),r.$on("$destroy",function(){F.off("resize",q)})}}},u=t.module("angular-d3-cluster",[]);u.directive("ngCluster",["$timeout",r])};"object"==typeof exports?module.exports=n(require("d3")):"function"==typeof define&&define.amd?define(["d3"],n):n(e.d3)}(angular,window);
//# sourceMappingURL=angular-d3-cluster.min.js.map